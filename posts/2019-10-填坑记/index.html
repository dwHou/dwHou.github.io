<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">

    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        <title>配置环境小记</title>

        <link rel="stylesheet" href="../../fonts/Serif/cmun-serif.css" />
        <link rel="stylesheet" href="../../fonts/Serif-Slanted/cmun-serif-slanted.css" />

        <!--BOOTSTRAP-->
        <link href="../../bootstrap/css/bootstrap.min.css" rel="stylesheet">
        <!--mobile first-->
        <meta name="viewport" content="width=device-width, initial-scale=1.0">

        <!--removed html from url but still is html-->
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

        <!--font awesome-->
        <link href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" rel="stylesheet">

        <!--fonts: allan & cardo-->
        <link href="http://fonts.googleapis.com/css?family=Droid+Serif" rel="stylesheet" type="text/css">
        <link href="http://fonts.googleapis.com/css?family=Droid+Sans" rel="stylesheet" type="text/css">

        <link href="../../css/sticky-footer-navbar.css" rel="stylesheet">

        <link href="../../css/default.css" rel="stylesheet">

        <link href="../../comments/inlineDisqussions.css" rel="stylesheet">

        <!--Highlight-->
        <link href="../../highlight/styles/github.css" rel="stylesheet">

        <link href="../../favicon.ico" rel="shortcut icon" />

        <!--<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>-->
        <script type="text/javascript" src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

        <style>
        .post{width:170px;min-height:175px;padding-left:5px;padding-right:5px;float:left;border-left:1px solid #CCC;background-color:white;}
        div a:first-of-type .post { border-left: none; }
        .post:hover {filter: brightness(90%);}
        .post h3{margin:5px;font-size:75%;text-align:center}
        .post h4{margin:0px;font-size:50%;text-align:center}
        .post img{margin:0px;padding:2px;margin-bottom:10px;width:100%;height:155px}
        </style>

        <script>
          (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
          (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
          })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

          ga('create', 'UA-49811703-1', 'dwHou.github.io');
          ga('require', 'linkid', 'linkid.js');
          ga('require', 'displayfeatures');
          ga('send', 'pageview');

        </script>

    </head>

    <body>
        <div id="wrap">
            <nav class="navbar navbar-inverse navbar-static-top" role="navigation">
                <div class="container">
                    <!--Toggle header for mobile-->
                    <div class="navbar-header">
                        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                            <span class="sr-only">Toggle navigation</span>
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                        </button>
                        <a class="navbar-brand active" href="../../" style="font-size:20px;">De's blog</a>
                    </div>
                    <!--normal header-->
                    <div class="navbar-collapse collapse">
                        <ul class="nav navbar-nav navbar-right">
                            <li><a href="../../"><span class="glyphicon glyphicon-pencil"></span>  Blog</a></li>
                            <li><a href="../../about.html"><span class="glyphicon glyphicon-user"></span>  About</a></li>
                            <li><a href="../../contact.html"><span class="glyphicon glyphicon-envelope"></span>  Contact</a></li>
                            <li><a href="../../demo.html"><span class="glyphicon glyphicon-play"></span>  ALGO</a></li>
                        </ul>
                    </div><!--/.nav-collapse -->
                </div>
            </nav>


            <div id="content">
                <div class="container">
                    <div class="row">
                        <div class="col-md-8">
                            <h1>配置环境填坑小记</h1>
                            <div style="font-size: 170%;">方法永远比困难多</div>
                            <br>
                            <div class="info">
    <p style="font-family:CMSS; font-size:120%">Posted on January 21, 2019</p>

    <!--
        by dwHou
    -->
</div>
</br>







  <p>
    计算机科学除了有丰富的理论内涵，也是一门锻炼工程能力的实践科学，<i>填坑力</i> 就成为了解决问题的能力中一个重要的方面。
    类似医院里的实习医师、法庭内外的年轻律师、中学里的青年教师，ta们的能力同样是在不断的实践摸索中成长的。要学会投入工作，
    加入自己的思考，不断填坑又爬坑逐渐掌握无可替代的经验和能力。计算机的专家也是在坐得住地debug中、不断参与比赛、解决项目中，
    成长为能写出bug-free clean and elegant的代码。理论和实践，都值得投入学习取得进步。
  </p>



  <h2>CUDA和显卡驱动以及pytorch版本的对应关系</h2>
  <a href="https://developer.aliyun.com/article/1294181">参考文章</a>

  <h2>安装多版本CUDA时</h2>

  <style>
    ul li {
      margin-top: 12px;
    }

    .tight-list li {
      margin-top: 6px;
    }
  </style>

  <ul>
  <li><b>历史版本</b> cuda https://developer.nvidia.com/cuda-toolkit-archive cudnn https://developer.nvidia.com/rdp/cudnn-archive </li>
  <li><b>多版本</b> https://blog.csdn.net/Tesion_001/article/details/89737044 </li>
  <li><b>检查nvcc</b> https://stackoverflow.com/questions/53422407/different-cuda-versions-shown-by-nvcc-and-nvidia-smi</li>
    <pre>nvcc --version和nvidia-smi显示的cuda版本不一致。务必以nvcc的为准。安装cuda时遵循指南，并且检查必要的<a href="https://docs.nvidia.com/cuda/archive/11.8.0/cuda-installation-guide-linux/index.html#system-requirements">环境要求</a>。</pre>
  </ul>

  <h2>Linux更改用户环境变量和所有用户环境变量</h2>


  <ul>

  <li><b>创建用户</b> https://www.cnblogs.com/sunyllove/p/9772053.html </li>
  <li><b>修改用户环境</b> https://blog.csdn.net/weixin_38361347/article/details/93392842 </li>
  <li><b>具体修改CUDA环境</b> https://blog.csdn.net/Tesion_001/article/details/89737044 </li>
  <li><b>关于沿用root配置的环境</b> usermod -g root devonn</li>


  </ul>


  <h2>安装CUDA</h2>


    去官网，会生成所需版本的安装命令，如：
    <p><i>wget http://developer.download.nvidia.com/compute/cuda/10.1/Prod/local_installers/cuda_10.1.243_418.87.00_linux.run</i></p>
    <p><i>sudo sh cuda_10.1.243_418.87.00_linux.run</i></p>
    <p><div align="left">附1：<font color="#FF9797">CUDA对应的NVIDIA驱动版本对照表</font></div> https://blog.csdn.net/zhw864680355/article/details/90411288</p>
    <p>附2：看看别人的填坑记 https://blog.csdn.net/QLULIBIN/article/details/78714596</p>
    <p>注1：配置环境一般考虑较新的稳定版，而不是追求最新。版本还可以再更新，而不要现在去冒着driver、toolkit、platform兼容上的风险。</p>


  <h2>安装版本检查</h2>
  pip安装一般会自动检查，只可以安装和系统适配的whl（Wheel，是Python软件包的一种二进制分发格式）。
  但希望pip install xx.whl时，一般可以根据名称检查是否适配。下载合适的whl文件。
  <pre>python -m pip debug --verbose</pre>可以检查环境版本。
  <pre>xxx-cp310-cp310-manylinux_2_28_x86_64.whl</pre>名称指示了适配的环境版本。
  <pre>python3 -m site 可查看默认的安装目录</pre>

  <h2>apt或pip install遇到网络问题</h2>
  <pre>
    问题<a href="https://stackoverflow.com/questions/52815784/python-pip-raising-newconnectionerror-while-installing-libraries">link1</a>, <a href="https://stackoverflow.com/questions/77623957/pip-warning-retrying-retrytotal-4-connect-none-read-none-redirect-none-st">link2</a>.
    可以猜测是DNS问题。可增加公共DNS服务器：
    cat << EOF > /etc/resolv.conf
    nameserver 8.8.8.8
    nameserver 8.8.4.4
    EOF
  </pre>

  <h2>TensorFlow安装</h2>

  <p>
    通常和CUDA版本安装一起考虑。
  </p>

  <ul>
  <li><b>tensorflow for windows</b>
  <p>https://www.cnblogs.com/xianhan/p/9084815.html</p>
  <p>https://www.cnblogs.com/guoyaohua/p/9265268.html</p>
  <p>https://blog.csdn.net/gyp2448565528/article/details/79451212</li></p>


  </ul>

  <h2>PyTorch奇怪的报错</h2>
    RuntimeError: cuDNN error: CUDNN_STATUS_NOT_SUPPORTED.
    This error may appear if you passed in a non-contiguous input.
  <ul>
      <li>
          原因：版本不匹配
      </li>
      <li>
          解决方法：
          使用torch.backends.cudnn.enabled = False
      </li>
  </ul>


  <h2>anaconda</h2>

  <li><b>安装与配置</b> https://www.jb51.net/article/137772.htm</li>
   <li><b>jupyter快捷键</b> https://blog.csdn.net/HeatDeath/article/details/78030902</li>
   <li><b>jupyter魔法命令</b> https://blog.csdn.net/HeatDeath/article/details/78030902</li>
   <li><b>jupyter启动默认设置</b> https://blog.csdn.net/m0_37723350/article/details/89141276</li>
   <li>如果想从指定目录打开 命令时jupyter notebook + 路径即可</li>
   <li><b>如何翻墙访问云端的jupyter端口</b> 把远端端口映射到本地，浏览器可以本地打开：ssh -L 8008:localhost:8888 用户名@IP  就可以本地8008端口打开云端jupyter notebook.</li>
   <li>https://www.jianshu.com/p/013a95576cf6</li>
  </ul>


  <h2>nvidia断电驱动崩溃</h2>
  <ul>
    <li><b>驱动卸载重装</b> https://blog.csdn.net/Netooo/article/details/84888755</li>
    <li>记得chmod赋予run文件执行的权限</li>
  </ul>

  <h2>关于调试</h2>
  <ul>
    <li><b>|tee log.txt</b> 可以将终端内容输出记录到文本</li>
    <li><b>Compare</b> IDE中 Select for Compare & Compare with Selected</li>
  </ul>


  <h2>关于GCC (redhat系)</h2>
  <ul>
      <li>有许多模型算子，对部署的GCC版本有要求。比如某些DCNv2，需要gcc 5以上</li>
      <pre>
          # 使用scl软解集
          yum install centos-release-scl scl-utils -y
          yum install devtoolset-4-gcc.x86_64 devtoolset-4-gcc-c++.x86_64 devtoolset-4-gcc-gdb-plugin.x86_64 -y
          scl enable devtoolset-4 bash
      </pre>
      <li>以上方式可以在当前用户下，创建一个gcc 5.3的环境。而不影响root环境，也不影响当前用户其他环境。只是替换了编译器。</li>
      <li>通过gcc -v查看前后改变</li>
      <li>若出现动态库缺失或者版本不够，参见<a href="https://blog.csdn.net/qq_35374722/article/details/105841079">libstdc++.so.6*</a> </li>
  </ul>

  <h2>关于并发读取权重</h2>
  <pre>
    有一次乌龙，同事交付的代码有bug，每次运行会把权重覆盖一遍。导致我还以为并发torch.load大模型会出问题。
    虽然是乌龙事件，root cause是并发覆盖权重。
    还是顺便记录下当时尝试的方案：
    try solution 1:
    with tempfile.NamedTemporaryFile(delete=True) as temp_file:
        temp_model_path = temp_file.name
        shutil.copy(model_path, temp_model_path)
        statedict = torch.load(temp_model_path, map_location=args_device)
        model.load_state_dict(statedict)

    try solution 2:
    from filelock import FileLock
    lock_path = model_path + ".lock"
    with FileLock(lock_path):
        statedict = torch.load(model_path, map_location=args_device)
        model.load_state_dict(statedict)

    try solution 3:
    甚至自己手写文件锁，主要利用os.path.exists(lockpath)来判断。也没有用。

    所以 1. 对同事交接的代码要有严格要求 2. 分析问题先全面看一看，不要过早做预设，找准root cause很重要。
  </pre>

  <h2>关于OpenCV</h2>
  <ul>
      <li>PIP3依赖有：opencv-python-headless, opencv-python, opencv-contrib-python</li>
      <li>这三者在完整性上是递增的，常用的opencv-python，如果你的环境报错缺少libSM，这是图形界面的库，
      如果你的环境不需要，可以把opencv-python的依赖改成opencv-python-headless。如果要用一些有专利
      收费的算法，则使用opencv-contrib-python.
      </li>
      <li>Of course there is opencv-contrib-python-headless</li>
      <pre>
            python中安装OpenCV提供四种依赖包

            1，如果只需要主要模块
            pip install opencv-python

            2，如果需要更全的模块
            pip install opencv-contrib-python

            3，如果资源较少，不需要任何GUI功能
            pip install opencv-python-headless

            4，如果资源较少，不需要任何GUI功能，包含contrib模块
            pip install opencv-contrib-python-headless
      </pre>
      <pre>
          有些仓库，比如MMCV<a href="https://github.com/ckkelvinchan/BasicVSR_PlusPlus/blob/master/requirements/runtime.txt">需要opencv-python</a>，可以采取如下方式：
          '''
            export DEBIAN_FRONTEND=noninteractive
            apt-get -y install tzdata
            apt-get update
            apt-get install ffmpeg libsm6 libxext6  -y
            pip3 install opencv-python
          '''
          再就是opencv如果不是在ffmpeg之后构建的，可能会有视频数据I/O方面的问题。
          值得小心的是，这类问题存在时并不会报错。但是会视作读取的视频为空视频（帧数为0）。
          '''
          apt update
          apt install -y ffmpeg
          pip uninstall -y opencv
          pip install opencv-python-headless (or apt install -y python3-opencv)
          '''
          排查时可以打印python3 -c "import cv2; print(cv2.__file__)" 看预装在哪儿的cv2
          然后将这个路径删掉，彻底清除cv2。如 <a href="https://github.com/NVIDIA/DALI/issues/5052">这个issue里的做法</a>。
          最后可以打印python3 -c "import cv2; print(cv2.getBuildInformation())"|grep FFMPEG看是不是yes
      </pre>
  </ul>

  <h2>nvidia-smi显存被占用,却没显示进程</h2>
  <ul>
      <li>使用fuser命令</li>
      fuser用于显示哪些进程正在使用给定的文件、文件系统或unix套接字
      <li>sudo fuser -v /dev/nvidia*</li>
      记住最好加sudo，因为有些进程是只有系统管理员可见的。
      查看占用指定显卡的进程id之后，kill掉就好了。
      <li>kill -9 PID</li>
  </ul>

  <h2>远程终端标准输出的恢复</h2>
  如果使用<font color="red">tmux</font>、<a href="https://www.jianshu.com/p/26cf6f0c6801">screen</a>、supervisor，它们有进程托管的功能可以很好的恢复。但关闭普通的远程终端，如何恢复标准输出呢？
  <li><a href="https://blog.csdn.net/mountzf/article/details/51735691">tty/pts详解</a> </li>
  <li>先ps ef找到进程号PID，这时也能看到TTY(与进程关联的终端),STAT是检查的状态R运行，S睡眠，l空闲。</li>
  <li>首先找到进程号，然后获取进程的标准输出。linux一切到可以看作文件，/proc/pid/fd/1 就是pid进程的标准输出。</li>
  Maybe these schema can clarify the situation. This is the usual setting:
  <pre>
      Terminal  (/dev/ttyX or /dev/pts/x)
                                device
                                   |
                    (screen)<--[<output]----x-------(stdout) Process1
        Terminal  (keyboard)---[input >]---o-\----->(stdin)
                                            \ \
(hardware console or                         \ `----(stdout) Process2
 virtual console or terminal                  `---->(stdin)
 emulators like xterm, …)
  </pre>
  And there is no way to plug some new Process3 like this:
  <pre>
      Terminal
                              device
                                 |
             (screen)<---o---[<output]--x------(stdout) Process1
  Terminal (keyboard)---/-x--[input >]-o-\---->(stdin)
                       | /              \ \
                       | |               \ `---(stdout) Process2
                       | |                `--->(stdin)
                       | |
                       \ `---------------------(stdout) Process3
                        `--------------------->(stdin)
  </pre>
  What screen (and others) does is allocating some pseudo terminal device (like xterm does)
  and redirect it to one or more "real" terminals (physical, virtual, or emulated):
  <pre>
      Terminal                   pseudo
             devices              ,--> Terminal (/dev/pts/x)
                |         _______/      device
Terminal <--[<output]--- |       |        |
 1       ---[input >]--> |screen | <--[<output]---x-----(stdout) Process1
                         |Process| ---[input >]--o-\--->(stdin)
Terminal <--[<output]--- |       |                \ \
 2       ---[input >]--> |_______|                 \ `--(stdout) Process2
                                                    `-->(stdin)
  </pre>
  Using screen -x you can attach one more terminal, xterm, whatever (say Terminal 3) to the screen session.<br>
  So no, you can't communicate directly through stdin/stdout with processes attached to a different terminal.
  You can only do so through the process that is controlling this terminal if it happens to be a pseudo terminal,
  and if this process was concieved to do so (like screen is).
  https://unix.stackexchange.com/questions/17838/how-can-i-switch-between-ttys-without-using-screen
  <li>
      所以最好是使用tmux:<br>
      The simple answer is that if you want to reconnect to a terminal from a different place, use screen or tmux.
  </li>

  <h2>磁盘推出</h2>
  <ul>
  <li>磁盘没有被推出，因为一个或多个程序可能正在使用它。</li>
      <pre>
          df -lh 查看硬盘编号，如/dev/disk2s1

          lsof /Volumes/Seagate/

          打开活动监视器 Activity Monitor，找到 QuickLook，强制退出
          如果 lsof /Volumes/Seagate/ 没有输出的话，加上 sudo 再执行 sudo lsof /Volumes/Seagate/，
          估计会发现是 mds 和 mds_store 在后台搞鬼, 这两个是 SpotLight 的进程，强退之！
      </pre>
      <li> lsof : lists openfiles 列出打开文件。 <font color="red">注：</font>在Unix中一切（包括网络套接口）都是文件。</li>
  </ul>

  <h2>跳板机掉线</h2>
  <ul>
      <li>检查机器是否设置永不休眠</li>
      <pre>
      Mac os 在设置关闭显示器不休眠中有两个状态分别为“电池”与“电源适配器”
      Step1：系统编好设置 — 节能——电池，勾选“当显示器关闭时，防止电脑自动进入睡眠”，取消“如果可能，使硬盘自动进入睡眠”。
      Step1：系统编好设置 — 节能——电源适配器，勾选“当显示器关闭时，防止电脑自动进入睡眠”，取消“如果可能，使硬盘自动进入睡眠”。
      </pre>
      <li>检查客户端是否设置保持活动状态</li>
  </ul>

  <h2>跳板机掉云盘</h2>
  <ul>
    <li>/etc/fstab 可以查看云盘、硬盘地址。</li>
  </ul>
  <pre>
    /etc/fstab 文件用于配置和定义文件系统的挂载点。在这个文件中，你可以找到以下信息：

    设备文件：每个挂载的文件系统的设备名称（如 /dev/sda1、UUID、LABEL 等）。
    挂载点：文件系统在系统中的挂载位置（如 /、/home、/mnt/data 等）。
    文件系统类型：文件系统的类型（如 ext4、xfs、nfs 等）。
    挂载选项：一系列选项，控制文件系统的挂载行为（如 defaults、ro、rw、noatime 等）。
    转储选项：用于备份的选项，通常是 0 或 1，表示是否需要进行转储（dump）。
    自检顺序：在启动时，fsck 命令检查文件系统的顺序，0 表示不检查，1 表示根文件系统，2 表示其他文件系统。
    这个文件对系统管理员非常重要，因为它影响着系统启动时文件系统的挂载方式和顺序。
  </pre>

  <h2>Shell下不能使用Tab补全命令</h2>
  <ul>
      这是因为/etc/passwd中该用户的默认shell不是/bin/bash
      <li>修改方式 1. chsh命令</li>
      <li>修改方式 2. sudo vim /etc/passwd</li>
      /home/hdw:/bin/bash
      <li>修改方式 3. usermod - s /bin/bash 用户名</li>
      -s 修改用户登入后所使用的shell。
  </ul>

  <h2>服务器禁止内核自动更新</h2>
  <pre>
      内核默认会自动更新，更新到某些版本可能和显卡驱动不适配。
      所以最好是禁止自动更新：
      https://blog.csdn.net/weixin_43064339/article/details/88370372
      如果已经发生内核变动、更新，显卡显示不出来，可以稍微补救下：
      https://www.jianshu.com/p/3cedce05a481
      如果是没死机的情况显卡出现问题，nvidia也提供了自检命令：
      https://blog.csdn.net/u012759006/article/details/103629003
      不过这个还没正式用过，不晓得有帮助不

      宕机查看下 /var/log/kern.log
      也可以看看last -F 宕机当天的用户登录情况
  </pre>

  <h2>编程程序CPU过高</h2>
  <pre>
    <a href="https://piaohua.github.io/post/linux/20240524-top9-cases-behind-100-cpu-usage/">内存不足、忙等待、并发、...</a>
    其它原因：程序本身在循环执行CPU密集型的操作，瞬时CPU占用会极高。假设此操作耗时很短，很快会释放CPU，但如果程序没有任何间隔，紧接着循环进行该操作，CPU将持续处于高负载状态，这不仅会导致CPU温度升高，还可能影响其他进程的性能。
  </pre>

  <h2>Linux crontab 定期执行程序</h2>
  <pre>
      crontab [ -u user ] { -l | -r | -e }
      -e : 执行文字编辑器来设定时程表
      -r : 删除目前的时程表
      -l : 列出目前的时程表

      注：定时执行top命令需要 -b
      http://blog.itpub.net/25311408/viewspace-686412
  </pre>


  <h2>Chrome连接问题</h2>
  <pre>
    Chrome您的连接不是私密连接
    解决：就是在当前页面用键盘输入  thisisunsafe  ，不是在地址栏输入，就直接敲键盘就行了，页面即会自动刷新进入网页。
    thisisunsafe 这个命令，说明你已经了解并确认这是个不安全的网站，你仍要访问就给你访问了。
  </pre>

  <h2>根据安全要求升级软件包</h2>
  <pre>
    sudo apt update
    apt list --upgradable
    sudo apt-get install --only-upgrade package1 package2 ...
    或
    sudo apt upgrade package1 package2 ...
  </pre>

  <h2>man apt查看手册</h2>
  <pre>
    apt-get 是在基于 Debain 的机器(如Ubuntu)中进行包/应用程序管理的命令。

    更新和升级选项之间存在细微差别。

    ・sudo apt-get update # 获取最新资源包
    是更新源列表的命令，如果您修改源列表或者想要进行同步刷新或添加新的ppa源，那么您应该执行上面的命令。

    ・sudo apt-get upgrade # 更新本机已安装的软件包
    命令将尝试下载在apt服务器上具有更新的所有软件包，然后尝试按下“y”时安装它们。这就像系统升级到新包。

    ・sudo apt-get dist-upgrade # 本机系统软件更新
    dist-upgrade命令也算更新所有软件包，但是当 upgrade 更新时，如果依赖关系无法解决时可能会报错或者停止，但是 dist-upgrade 命令可以自动解决依赖关系

    但是 dist-update 有一定的危险性，因为可能会更新很大您不希望更新的软件，导致原理的一些需要依赖旧包的软件无法运行。
    所以，使用 apt-get dist-upgrade 时，请慎重使用，一般是 apt-get update && apt-get upgrade 可以保证系统的完整性。
  </pre>
  <pre>
    apt-get是某些linux发行版使用的一个“包管理器”（还有别的发行版使用yum等，以及brew等其他平台上的包管理器，工作原理类似）。
包管理器的作用是从 <font color="brown">源（Source）服务器那里下载最新的软件包列表</font> (PS：软件源服务器地址可以在/etc/apt/sources.list里面看到。)，然后在你需要安装某个软件包（apt-get install）的时候从列表里面查询这个软件包的版本信息、系统要求、翻译、依赖项（该软件正常运行必须安装的其它软件）并且添加到同时安装的列表里面，再查询所有安装列表里面的软件包的.deb文件下载地址，最后批量下载，自动分析安装顺序然后安装完成。
<font color="brown">但是这个软件包列表是不会被自动下载的，需要用户使用apt-get update更新</font>。这样，apt-get才能知道每个软件包的最新信息，从而正确地下载最新版本的软件。
<font color="brown">至于apt-get upgrade，则是对已经安装的软件包本身进行更新的过程</font>。由于确定要更新的软件包需要对本地安装的版本和列表的版本进行比较，所以要在update以后运行这一条。
<font color="brown">apt-get dist-upgrade会识别出当依赖关系改变的情形并作出处理</font>(所以通常这个会被认为是有点风险的升级)，而apt-get upgrade对此情形不处理。
<font color="gray">例如软件包 a 原先依赖 b c d，但是在源里面可能已经升级了，现在是 a 依赖 b c e。这种情况下，dist-upgrade 会删除 d 安装 e，并把 a 软件包升级，而 upgrade 会认为依赖关系改变而拒绝升级 a 软件包。</font>
  </pre>
  <pre>
    <font color="skyblue">请改用 apt 命令</font>

    apt-get 是一个传统的低级命令，可以做很多事情。它适合由其他工具或系统管理员在脚本中使用。
    apt 命令是一个简化版本，面向普通的临时用户。它比 apt-get 做得更好、更简单。
    apt 命令被设计为对用户更加友好的 apt-get 替代方案，来自<a href="https://aws.amazon.com/cn/compare/the-difference-between-apt-and-apt-get/">AWS建议</a>
  </pre>

  <h2>安装nvidia显卡驱动</h2>
  <pre>
    <font color="blue">方式1：</font><a href="https://www.nvidia.com/en-us/drivers/">官网</a>下载run包，然后运行即可。
    会询问 是否安装32位兼容库；是否安装NVIDIA 3D媒体库；是否更新X配置；是否要安装DKMS。
    <font color="blue">方式2：</font>可以依次执行sudo apt-get update, sudo apt-get upgrade, sudo ubuntu-drivers autoinstall 自动安装驱动。
    但英伟达驱动有bug，会导致机器能进入自动休眠，可以查看/var/log/syslog | grep sleep了解。
    以下操作关闭自动休眠：
    sudo systemctl stop nvidia-suspend.service  nvidia-hibernate.service nvidia-resume.services
    sudo systemctl mask  nvidia-suspend.service  nvidia-hibernate.service  nvidia-resume.service
    sudo rm /lib/systemd/system-sleep/nvidia
    sudo systemctl stop sleep.target suspend.target hibernate.target hybrid-sleep.target
    sudo systemctl mask sleep.target suspend.target hibernate.target hybrid-sleep.target
    其他和睡眠模式相关的：
    可以查看/sys/power/mem_sleep，以前是s1、s2、s3，新系统可能是shallow、s2idle、deep
  </pre>

  <h2>关于显卡的温度监控</h2>
  <pre>
    指定显卡重启：
    nvidia-smi --gpu-reset -i 0
    如果没能正常重启，有可能是<a href="https://forums.developer.nvidia.com/t/nvidia-smi-showing-err-in-all-fields-for-one-of-the-gpus-a40/210862">烧坏</a>了。
    nvidia-smi窗口直接就有显示温度，下面的命令进行温度持续监控。
    nvidia-smi --query-gpu=temperature.gpu -i 7 --format=csv >> xxx.log
  </pre>

  <h2>ssh连接失败排查</h2>
  <pre>
    ・ 使用ssh -vvv命令，以debug模式查看ssh连接过程中的每一个步骤。
    ・ 实在不行，在机房接上显示器、键盘，直接ctrl+alt+F3进入命令行模式，然后重启ssh服务。而无需物理重启机器。
  </pre>

  <h2>关于youtube视频下载器</h2>
  做CV，经常会到youtube收集数据集。有时会有一些downloader的库找不到视频，其实是被禁了。这时不用被block，果断换一个库尝试。
  而且几个库可以换着尝试，它们都在不断维护、更新，上一次落伍的库可能下一次更新在前面了。
<pre>
    比如：
    https://github.com/AliaksandrSiarohin/video-preprocessing的issue：
</pre>
<pre>
def download(video_id, args):
    video_path = os.path.join(args.video_folder, video_id + ".mp4")
    subprocess.call([args.youtube, '-f', "''best/mp4''", '--write-auto-sub', '--write-sub',
                     '--sub-lang', 'en', '--skip-unavailable-fragments',
                     "https://www.youtube.com/watch?v=" + video_id, "--output",
                     video_path], stdout=DEVNULL, stderr=DEVNULL)
    return video_path
</pre>
替换为（youtube-dl替换为yt-dlp或pytube）
<pre>
def download(ytb_id, args, proxy=None):
    """
    ytb_id: youtube_id
    save_folder: save video folder
    proxy: proxy url, defalut None
    """
    video_path = os.path.join(args.video_folder, ytb_id + ".mp4")
    if proxy is not None:
        proxy_cmd = "--proxy {}".format(proxy)
    else:
        proxy_cmd = ""
    if not os.path.exists(video_path):
        down_video = " ".join([
            "yt-dlp",
            proxy_cmd,
            '-f', "'bestvideo[ext=mp4]+bestaudio[ext=m4a]/bestvideo+bestaudio'",
            '--skip-unavailable-fragments',
            '--merge-output-format', 'mp4',
            "https://www.youtube.com/watch?v=" + ytb_id, "--output",
            video_path, "--external-downloader", "aria2c",
            "--external-downloader-args", '"-x 16 -k 1M"'
        ])
        print(down_video)
        status = os.system(down_video)
        if status != 0:
            print(f"video not found: {ytb_id}")
    return video_path
</pre>
<pre>
    <a href="https://zhuanlan.zhihu.com/p/431013905">yt-dlp参数：</a>
    yt-dlp -f [下载ID] [代理配置] [视频链接] [合并语句] [外部下载器选择] [下载器参数]
-f [id] #选择下载内容，注意和 -F 区分。例子中使用137+140，如果你只下载720p则填写22就好，后面的合并语句可不填写。
--proxy #代理配置 见前文
--merge-output-format [合并输出格式] #例子中选择mp4作为输出格式
--external-downloader [下载器名称] #下载器选择 例子中选择aria2c
--downloader-args [下载器名称]:"[下载器配置]" #下载器配置语句 例子中 x 16 代表16线程下载 -k 1M 代表块大小为1M 但youtube不支持分块故此句可忽略
</pre>

<h2>关于git文件夹重命名仅更改大小写</h2>
<pre>
  git的设置是大小写不敏感。如果希望能识别仅更改大小写的重命名，可以如下操作：
  git rm -r --cached folder 先取消folder的跟踪 重命名folder 然后git add folder
</pre>

<h2>远程主机不满足运行 VS Code 服务器的先决条件</h2>
<pre>
  从 VS Code 版本 1.99（2025 年 3 月）开始，由 VS Code 分发的预构建服务器仅与基于 glibc 2.28 或更高版本的 Linux 发行版兼容。例如，这些包括 Debian 10、RHEL 8 或 Ubuntu 20.04。

  临时解决方案：
  1. 覆盖安装前先到<a href="vscode://settings/update.mode ">设置</a>中 关闭 VS Code 的自动更新，否则重装后仍会自动更新。
  2. 下载 VS Code 最后可用的版本 1.98.2 重装即可正常连接远程服务器。旧版本下载页 <a href="https://code.visualstudio.com/docs/supporting/faq#_previous-release-versions">link</a>

</pre>


<!-- 加载出评论，是使用Disqus的论坛短名（shortname）
A shortname is the unique identifier assigned to a Disqus site.

https://segmentfault.com/a/1190000005773009
https://help.disqus.com/en/articles/1717111-what-s-a-shortname
https://blog.csdn.net/weixin_34327761/article/details/89630337
   -->

<div id="disqus_thread"></div>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
<script src="http://code.jquery.com/jquery-1.10.1.min.js"></script>

<script src="../../comments/inlineDisqussions.js"></script>
<script src="../../js/disqus.js"></script>

                        </div>
                        <div class="col-md-4"></div>
                    </div>
                </div>
            </div>


            <div id="footer">
                <div class="container">
                    Built by <a href="https://github.com/oinkina">Oinkina</a> with
                    <a href="http://jaspervdj.be/hakyll">Hakyll</a>
                    using <a href="http://getbootstrap.com/">Bootstrap</a>,
                    <a href="http://www.mathjax.org/">MathJax</a>,
                    <a href="http://disqus.com/">Disqus</a>,
                    <a href="https://github.com/unconed/MathBox.js">MathBox.js</a>,
                    <a href="http://highlightjs.org/">Highlight.js</a>,
                    and <a href="http://ignorethecode.net/blog/2010/04/20/footnotes/">Footnotes.js</a>.
                </div>
            </div>
        </div>

    <!-- jQuery-->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
    <script src="http://code.jquery.com/jquery-1.10.1.min.js"></script>

    <script src="../../bootstrap/js/bootstrap.min.js"></script>

    <script src="../../highlight/highlight.pack.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>

    <script src="../../js/footnotes.js"></script>

    <script src="../../comments/inlineDisqussions.js"></script>

    <noscript>Enable JavaScript for footnotes, Disqus comments, and other cool stuff.</noscript>

    </body>

</html>
