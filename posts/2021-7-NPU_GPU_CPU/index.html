<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">

    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        <title>X-PU</title>

        <link rel="stylesheet" href="../../fonts/Serif/cmun-serif.css" />
        <link rel="stylesheet" href="../../fonts/Serif-Slanted/cmun-serif-slanted.css" />

        <!--BOOTSTRAP-->
        <link href="../../bootstrap/css/bootstrap.min.css" rel="stylesheet">
        <!--mobile first-->
        <meta name="viewport" content="width=device-width, initial-scale=1.0">

        <!--removed html from url but still is html-->
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

        <!--font awesome-->
        <link href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" rel="stylesheet">

        <!--fonts: allan & cardo-->
        <link href="http://fonts.googleapis.com/css?family=Droid+Serif" rel="stylesheet" type="text/css">
        <link href="http://fonts.googleapis.com/css?family=Droid+Sans" rel="stylesheet" type="text/css">

        <link href="../../css/sticky-footer-navbar.css" rel="stylesheet">

        <link href="../../css/default.css" rel="stylesheet">

        <link href="../../comments/inlineDisqussions.css" rel="stylesheet">

        <!--Highlight-->
        <link href="../../highlight/styles/github.css" rel="stylesheet">

        <link href="../../favicon.ico" rel="shortcut icon" />

        <!--<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>-->
        <script type="text/javascript" src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

        <style>
        .post{width:170px;min-height:175px;padding-left:5px;padding-right:5px;float:left;border-left:1px solid #CCC;background-color:white;}
        div a:first-of-type .post { border-left: none; }
        .post:hover {filter: brightness(90%);}
        .post h3{margin:5px;font-size:75%;text-align:center}
        .post h4{margin:0px;font-size:50%;text-align:center}
        .post img{margin:0px;padding:2px;margin-bottom:10px;width:100%;height:155px}
        </style>

        <script>
          (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
          (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
          })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

          ga('create', 'UA-49811703-1', 'dwHou.github.io');
          ga('require', 'linkid', 'linkid.js');
          ga('require', 'displayfeatures');
          ga('send', 'pageview');

        </script>

    </head>

    <body>
        <div id="wrap">
            <nav class="navbar navbar-inverse navbar-static-top" role="navigation">
                <div class="container">
                    <!--Toggle header for mobile-->
                    <div class="navbar-header">
                        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                            <span class="sr-only">Toggle navigation</span>
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                        </button>
                        <a class="navbar-brand active" href="../../" style="font-size:20px;">De's blog</a>
                    </div>
                    <!--normal header-->
                    <div class="navbar-collapse collapse">
                        <ul class="nav navbar-nav navbar-right">
                            <li><a href="../../"><span class="glyphicon glyphicon-pencil"></span>  Blog</a></li>
                            <li><a href="../../about.html"><span class="glyphicon glyphicon-user"></span>  About</a></li>
                            <li><a href="../../contact.html"><span class="glyphicon glyphicon-envelope"></span>  Contact</a></li>
                            <li><a href="../../demo.html"><span class="glyphicon glyphicon-play"></span>  ALGO</a></li>
                        </ul>
                    </div><!--/.nav-collapse -->
                </div>
            </nav>


            <div id="content">
                <div class="container">
                    <div class="row">
                        <div class="col-md-8">
                            <h1></h1>
                            <div style="font-size: 170%;">NPU、CPU和GPU</div>
                            <br>
                            <div class="info">
    <p style="font-family:CMSS; font-size:120%">Posted on Jul.21, 2021</p>

    <!--
        by dwHou
    -->
</div>
</br>

<style>
    ul li {
      margin-top: 12px;
    }

    .tight-list li {
      margin-top: 6px;
    }
  </style>



  <h2>比喻</h2>
  <ul>
  <li><b>GPU + TensorCore</b></li>
  相当于七座SUV(GPU)，某款车型后排座椅能收起来(TensorCore)放很多东西，偶尔搬点货很方便。
  <li><b>NPU</b></li>
  相当于运载车，专业能运很多货。
  <li><b>CPU + AMX</b></li>
  相当于一辆摩托车，大马路能跑小巷子也能钻，再加上个尾箱(AMX)就非常方便。
  <li>
  说白了，效率上就是NPU>AMX~Tensor Core>GPU>CPU。通用性反之。
  此外AMX和TensorCore作为类似的东西，背后暗藏的是CPU与GPU之争</li>
  </ul>


  转到特定框架进行部署，并且受益于内置的优化。之前许多框架不支持PyTorch直接转，而需要先转一次<a href=  https://www.onnxruntime.ai>ONNX</a>，现在比如CoreML可以直接转。
   
  <h2>Netron</h2>
  <ul>
  <li><a href="https://github.com/lutzroeder/netron">项目页</a></li>
  <pre>Netron supports ONNX, TensorFlow Lite, Keras, Caffe, Darknet, ncnn, MNN, PaddlePaddle, Core ML, MXNet, RKNN, MindSpore Lite, TNN, Barracuda, Tengine, TensorFlow.js, Caffe2 and UFF.</pre>
  <pre>转换完后用此工具观察一下，是否有被优化、甚至跳过的层。</pre>
  </ul>

  <h2>Core ML</h2>
  <ul>
  <li><b>概览</b></li>
  使用Core ML可以将机器学习模型集成到苹果平台(Mac/ios)的app中。
  它能对CPU、GPU和苹果神经元引擎(ANE)上的模型进行优化部署，使用更小的存储和功耗。
  <pre>
  Core ML模型的获得方式：
  1. 在Xcode中直接使用Create ML app进行创建和训练，得到的模型将会是Core ML格式。
  2. 可以使用各种各样的机器学习库，然后通过Core ML Tools将模型转换到Core ML格式。
  3. 在1、2基础上获得的模型可以被用来重新训练或者fine-tune，在所部署的用户设备上。
  </pre>
  <li><b>主题</b></li>
  <li><b>第一步</b> 获得一个Core ML模型</li>
  <pre>
  Core ML支持多样的机器学习模型，包括神经网络、决策树集成、支持向量机和广义线性模型。
  Core ML需要以 .mlmodel 为后缀的模型格式。

  使用coremltools转换模型到Core ML.
  </pre>
  <img src='./coremltools.png'>
  <pre>
    <a href="https://developer.apple.com/videos/play/tech-talks/10154/">WWDC大会上 PyTorch转CoreML的介绍</a>
    <a href="https://mybinder.org/v2/gh/ContinuumIO/coreml-demo/HEAD">Core ML Tools Jupyter上手学习</a>
  </pre>
  <li><b>Core ML Tools</b></li>
  <li>1. 转换第三方库和框架的模型到Core ML</li>
  <li>2. 阅读、编写和优化Core ML模型</li>
  <li><b>.mlmodel → .mlpackage</b></li>
  <pre>
  安装：
  pip install coremltools==5.0b2
  快速示例：
  1. 下载模型
  2. 转换模型
  3. 设置元数据：可以便于使用Xcode预览和Xcode的其他特性
  4. 进行推理
  5. 保存和加载模型
  6. 在Xcode中使用模型：例如部署到app中
  </pre>

  <pre>
  后者是新出来的，相对原始的.mlmodel,它的结构更清晰，容器包括了：
  Metadata(json), Interface/Architecture(protobuf), Learned-Parameters(binary)
  转换不会改变模型的类型和运作方式。

  # coremltools 5
  model.save("my_model.mlpackage")

  # coremltools 4
  model.save("my_model.mlmodel")
  </pre>
  <li>mlmodel.prediction时CPU/GPU/ANE的使用</li>
  <pre>
    
 
  </pre>

  </ul>

<!-- 加载出评论，是使用Disqus的论坛短名（shortname）
A shortname is the unique identifier assigned to a Disqus site. 

https://segmentfault.com/a/1190000005773009
https://help.disqus.com/en/articles/1717111-what-s-a-shortname
https://blog.csdn.net/weixin_34327761/article/details/89630337
   -->

<div id="disqus_thread"></div>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
<script src="http://code.jquery.com/jquery-1.10.1.min.js"></script>

<script src="../../comments/inlineDisqussions.js"></script>
<script src="../../js/disqus.js"></script>

                        </div>
                        <div class="col-md-4"></div>
                    </div>
                </div>
            </div>


            <div id="footer">
                <div class="container">
                    Built by <a href="https://github.com/oinkina">Oinkina</a> with
                    <a href="http://jaspervdj.be/hakyll">Hakyll</a>
                    using <a href="http://getbootstrap.com/">Bootstrap</a>,
                    <a href="http://www.mathjax.org/">MathJax</a>,
                    <a href="http://disqus.com/">Disqus</a>,
                    <a href="https://github.com/unconed/MathBox.js">MathBox.js</a>,
                    <a href="http://highlightjs.org/">Highlight.js</a>,
                    and <a href="http://ignorethecode.net/blog/2010/04/20/footnotes/">Footnotes.js</a>.
                </div>
            </div>
        </div>

    <!-- jQuery-->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
    <script src="http://code.jquery.com/jquery-1.10.1.min.js"></script>

    <script src="../../bootstrap/js/bootstrap.min.js"></script>

    <script src="../../highlight/highlight.pack.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>

    <script src="../../js/footnotes.js"></script>

    <script src="../../comments/inlineDisqussions.js"></script>

    <noscript>Enable JavaScript for footnotes, Disqus comments, and other cool stuff.</noscript>

    </body>

</html>
